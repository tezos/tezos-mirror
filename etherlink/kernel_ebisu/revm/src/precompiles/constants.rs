// SPDX-FileCopyrightText: 2025 Nomadic Labs <contact@nomadic-labs.com>
// SPDX-FileCopyrightText: 2025 Functori <contact@functori.com>
//
// SPDX-License-Identifier: MIT

use revm::primitives::{Address, FixedBytes};

pub(crate) const WITHDRAWAL_SOL_CONTRACT: &str = "0x60806040526004361015610013575b6102c5565b61001d5f3561003c565b806367a32cd7146100375763cda4fee20361000e5761029c565b61023d565b60e01c90565b60405190565b5f80fd5b5f80fd5b5f80fd5b5f80fd5b601f801991011690565b634e487b7160e01b5f52604160045260245ffd5b9061008090610058565b810190811067ffffffffffffffff82111761009a57604052565b610062565b906100b26100ab610042565b9283610076565b565b67ffffffffffffffff81116100d2576100ce602091610058565b0190565b610062565b90825f939282370152565b909291926100f76100f2826100b4565b61009f565b9381855260208501908284011161011357610111926100d7565b565b610054565b9080601f8301121561013657816020610133933591016100e2565b90565b610050565b67ffffffffffffffff811161015957610155602091610058565b0190565b610062565b9092919261017361016e8261013b565b61009f565b9381855260208501908284011161018f5761018d926100d7565b565b610054565b9080601f830112156101b2578160206101af9335910161015e565b90565b610050565b91606083830312610233575f83013567ffffffffffffffff811161022e57826101e1918501610118565b92602081013567ffffffffffffffff81116102295783610202918301610118565b92604082013567ffffffffffffffff8111610224576102219201610194565b90565b61004c565b61004c565b61004c565b610048565b5f0190565b61025161024b3660046101b7565b91610997565b610259610042565b8061026381610238565b0390f35b90602082820312610297575f82013567ffffffffffffffff81116102925761028f9201610118565b90565b61004c565b610048565b6102af6102aa366004610267565b610bb0565b6102b7610042565b806102c181610238565b0390f35b5f80fd5b5f1c90565b60ff1690565b6102e06102e5916102c9565b6102ce565b90565b6102f2905c6102d4565b90565b151590565b60209181520190565b5f7f5265656e7472616e6379206973206e6f7420616c6c6f77656400000000000000910152565b61033760196020926102fa565b61034081610303565b0190565b6103599060208101905f81830391015261032a565b90565b1561036357565b61036b610042565b62461bcd60e51b81528061038160048201610344565b0390fd5b5f1b90565b9061039660ff91610385565b9181191691161790565b6103a9906102f5565b90565b90565b906103c46103bf6103cb926103a0565b6103ac565b825c61038a565b905d565b906103ff92916103ef6103ea6103e45f6102e8565b156102f5565b61035c565b6103fa60015f6103af565b61081d565b6104095f5f6103af565b565b600560ff60981b0190565b60018060a01b031690565b90565b61043861043361043d92610416565b610421565b610416565b90565b61044990610424565b90565b61045590610440565b90565b61046190610424565b90565b61046d90610458565b90565b60e01b90565b90565b61048281610476565b0361048957565b5f80fd5b9050519061049a82610479565b565b906020828203126104b5576104b2915f0161048d565b90565b610048565b6104c2610042565b3d5f823e3d90fd5b5190565b90825f9392825e0152565b6104f8610501602093610506936104ef816104ca565b938480936102fa565b958691016104ce565b610058565b0190565b5190565b60209181520190565b61053661053f6020936105449361052d8161050a565b9384809361050e565b958691016104ce565b610058565b0190565b61055190610476565b9052565b9061059a6105ac9597969461058c60809561057e6105a59560a08801908882035f8a01526104d9565b9086820360208801526104d9565b908482036040860152610517565b966060830190610548565b0190610548565b565b600360ff60981b0190565b906105cb6105c68361013b565b61009f565b918252565b606090565b3d5f146105f0576105e53d6105b9565b903d5f602084013e5b565b6105f86105d0565b906105ee565b5f7f43616c6c20746f20746865206f7574626f782073656e646572206661696c6564910152565b610631602080926102fa565b61063a816105fe565b0190565b6106539060208101905f818303910152610625565b90565b1561065d57565b610665610042565b62461bcd60e51b81528061067b6004820161063e565b0390fd5b61dead90565b905090565b6106955f8092610685565b0190565b6106a29061068a565b90565b5f7f4661696c656420746f206275726e000000000000000000000000000000000000910152565b6106d9600e6020926102fa565b6106e2816106a5565b0190565b6106fb9060208101905f8183039101526106cc565b90565b1561070557565b61070d610042565b62461bcd60e51b815280610723600482016106e6565b0390fd5b60200190565b69ffffffffffffffffffff191690565b610747905161072d565b90565b1b90565b61076861076361075d8361050a565b92610727565b61073d565b9060168110610776575b5090565b6107929069ffffffffffffffffffff199060160360080261074a565b165f610772565b6107a29061072d565b9052565b6107af90610416565b90565b6107bb906107a6565b9052565b9695939461080661081b966107fc60a0966107f26108139760208e6107eb60c082019a5f830190610799565b0190610548565b60408c0190610548565b60608a0190610548565b8782036080890152610517565b9401906107b2565b565b349161085c61082b84610db6565b91602061084661084161083c61040b565b61044c565b610464565b635445a29190610854610042565b948592610470565b8252815f8161086d60048201610238565b03925af19182156109925761095f936108c95f936108ba6109259686958691610964575b509891938b908a916108a1610042565b968795600460208801631be3287960e31b815201610555565b60208201810382520382610076565b6108d16105ae565b9082602082019151925af16108ed6108e76105d5565b91610656565b6109205f806108fa61067f565b88610903610042565b908161090e81610699565b03925af161091a6105d5565b506106fe565b61074e565b919293429033917f62e8e01e31b83084b97c32b1b11ad5a2042382f5f65ee4106ad4a0d0f8b9942c96610956610042565b968796876107bf565b0390a1565b610985915060203d811161098b575b61097d8183610076565b81019061049c565b5f610891565b503d610973565b6104ba565b906109a292916103cf565b565b6109d2906109c26109bd6109b75f6102e8565b156102f5565b61035c565b6109cd60015f6103af565b610a42565b6109dc5f5f6103af565b565b929160206109fa610a029360408701908782035f8901526104d9565b940190610548565b565b610a39610a4094610a2f606094989795610a25608086019a5f870190610548565b60208501906107b2565b6040830190610799565b0190610548565b565b34610a7f610a4f82610db6565b6020610a69610a64610a5f61040b565b61044c565b610464565b635445a29190610a77610042565b948592610470565b8252815f81610a9060048201610238565b03925af1908115610bab57610adf5f939284938491610b7d575b5095610ad0610ab7610042565b938492600460208501631ef3b63960e21b8152016109de565b60208201810382520382610076565b610ae76105ae565b9082602082019151925af190610b04610afe6105d5565b92610656565b610b375f80610b1161067f565b84610b1a610042565b9081610b2581610699565b03925af1610b316105d5565b506106fe565b610b78610b44339361074e565b937f2d5ad793181f5b6bd727c0c216461e019ecfe466353fdde9ccf813f45b84fa8294610b6f610042565b94859485610a04565b0390a1565b610b9e915060203d8111610ba4575b610b968183610076565b81019061049c565b5f610aaa565b503d610b8c565b6104ba565b610bb9906109a4565b565b5f90565b90565b610bd6610bd1610bdb92610bbf565b610421565b610476565b90565b610bec64e8d4a51000610bc2565b90565b634e487b7160e01b5f52601260045260245ffd5b610c0f610c1591610476565b91610476565b908115610c20570490565b610bef565b610c31610c3791610476565b91610476565b908115610c42570690565b610bef565b90565b610c5e610c59610c6392610c47565b610421565b610476565b90565b5f7f416d6f756e74206973207a65726f000000000000000000000000000000000000910152565b610c9a600e6020926102fa565b610ca381610c66565b0190565b610cbc9060208101905f818303910152610c8d565b90565b15610cc657565b610cce610042565b62461bcd60e51b815280610ce460048201610ca7565b0390fd5b60407f657a290000000000000000000000000000000000000000000000000000000000917f526f756e64696e6720776f756c64206c6f7365207765692c20616d6f756e74205f8201527f6d757374206265206d756c7469706c65206f662031305e3132202831206d757460208201520152565b610d6860436060926102fa565b610d7181610ce8565b0190565b610d8a9060208101905f818303910152610d5b565b90565b15610d9457565b610d9c610042565b62461bcd60e51b815280610db260048201610d75565b0390fd5b610dbe610bbb565b50610e1b610dd482610dce610bde565b90610c03565b91610e03610dea82610de4610bde565b90610c25565b91610dfd610df75f610c4a565b91610476565b11610cbf565b610e15610e0f5f610c4a565b91610476565b14610d8d565b9056fea264697066735822122012d3001fffe0ce6e63f20f4bdb7e919900d09f53bb71d992aaebfd07376377ab64736f6c634300081d0033";

pub(crate) const FA_BRIDGE_SOL_CONTRACT: &str = "0x60806040526004361015610013575b61045b565b61001d5f3561004c565b8063379607f51461004757806380fc1fe3146100425763fff7ca5f0361000e5761042b565b6102b1565b6100a9565b60e01c90565b60405190565b5f80fd5b5f80fd5b90565b61006c81610060565b0361007357565b5f80fd5b9050359061008482610063565b565b9060208282031261009f5761009c915f01610077565b90565b610058565b5f0190565b6100bc6100b7366004610086565b610e22565b6100c4610052565b806100ce816100a4565b0390f35b60018060a01b031690565b6100e6906100d2565b90565b6100f2816100dd565b036100f957565b5f80fd5b9050359061010a826100e9565b565b5f80fd5b5f80fd5b601f801991011690565b634e487b7160e01b5f52604160045260245ffd5b9061013c90610114565b810190811067ffffffffffffffff82111761015657604052565b61011e565b9061016e610167610052565b9283610132565b565b67ffffffffffffffff811161018e5761018a602091610114565b0190565b61011e565b90825f939282370152565b909291926101b36101ae82610170565b61015b565b938185526020850190828401116101cf576101cd92610193565b565b610110565b9080601f830112156101f2578160206101ef9335910161019e565b90565b61010c565b69ffffffffffffffffffff191690565b610210816101f7565b0361021757565b5f80fd5b9050359061022882610207565b565b91909160a0818403126102ac57610243835f83016100fd565b92602082013567ffffffffffffffff81116102a757816102649184016101d4565b926102728260408501610077565b92610280836060830161021b565b92608082013567ffffffffffffffff81116102a25761029f92016101d4565b90565b61005c565b61005c565b610058565b6102c86102bf36600461022a565b9392909261167e565b6102d0610052565b806102da816100a4565b0390f35b67ffffffffffffffff81116102fc576102f8602091610114565b0190565b61011e565b90929192610316610311826102de565b61015b565b938185526020850190828401116103325761033092610193565b565b610110565b9080601f830112156103555781602061035293359101610301565b90565b61010c565b9060e08282031261042657610371815f84016100fd565b92602083013567ffffffffffffffff811161042157826103929185016101d4565b926103a08360408301610077565b926103ae816060840161021b565b92608083013567ffffffffffffffff811161041c57826103cf9185016101d4565b9260a081013567ffffffffffffffff811161041757836103f0918301610337565b9260c082013567ffffffffffffffff81116104125761040f92016101d4565b90565b61005c565b61005c565b61005c565b61005c565b610058565b61044561043936600461035a565b95949094939193611bd6565b61044d610052565b80610457816100a4565b0390f35b5f80fd5b5f1c90565b60ff1690565b61047661047b9161045f565b610464565b90565b610488905c61046a565b90565b151590565b60209181520190565b5f7f5265656e7472616e6379206973206e6f7420616c6c6f77656400000000000000910152565b6104cd6019602092610490565b6104d681610499565b0190565b6104ef9060208101905f8183039101526104c0565b90565b156104f957565b610501610052565b62461bcd60e51b815280610517600482016104da565b0390fd5b5f1b90565b9061052c60ff9161051b565b9181191691161790565b61053f9061048b565b90565b90565b9061055a61055561056192610536565b610542565b825c610520565b905d565b6105939061058361057e6105785f61047e565b1561048b565b6104f2565b61058e60015f610545565b610b57565b61059d5f5f610545565b565b6105a890610060565b9052565b91906105bf905f6020850194019061059f565b565b600460ff60981b0190565b906105de6105d983610170565b61015b565b918252565b606090565b3d5f14610603576105f83d6105cc565b903d5f602084013e5b565b61060b6105e3565b90610601565b5f7f436f756c64206e6f742066696e64206465706f73697400000000000000000000910152565b6106456016602092610490565b61064e81610611565b0190565b6106679060208101905f818303910152610638565b90565b1561067157565b610679610052565b62461bcd60e51b81528061068f60048201610652565b0390fd5b5f80fd5b905051906106a482610063565b565b905051906106b3826100e9565b565b919060c08382031261073757610730906106cf60c061015b565b936106dc825f8301610697565b5f8601526106ed82602083016106a6565b60208601526106ff82604083016106a6565b60408601526107118260608301610697565b60608601526107238260808301610697565b608086015260a001610697565b60a0830152565b610693565b9060c08282031261075557610752915f016106b5565b90565b610058565b5190565b61076890516100dd565b90565b6107759051610060565b90565b610781906100dd565b9052565b6040906107ae6107b594969593966107a460608401985f850190610778565b602083019061059f565b019061059f565b565b60209181520190565b90825f9392825e0152565b6107ea6107f36020936107f8936107e18161075a565b938480936107b7565b958691016107c0565b610114565b0190565b9161081f9261081260408201935f830190610778565b60208184039101526107cb565b90565b5f90565b5f7f53797374656d20666f72776172646572206661696c6564000000000000000000910152565b61085a6017602092610490565b61086381610826565b0190565b61087c9060208101905f81830391015261084d565b90565b1561088657565b61088e610052565b62461bcd60e51b8152806108a460048201610867565b0390fd5b6108b18161048b565b036108b857565b5f80fd5b905051906108c9826108a8565b565b909291926108e06108db82610170565b61015b565b938185526020850190828401116108fc576108fa926107c0565b565b610110565b9080601f8301121561091f5781602061091c935191016108cb565b90565b61010c565b9190916040818403126109645761093d835f83016108bc565b92602082015167ffffffffffffffff811161095f5761095c9201610901565b90565b61005c565b610058565b604090610992610999949695939661098860608401985f85019061059f565b6020830190610778565b019061059f565b565b60407f756e7375636365737366756c0000000000000000000000000000000000000000917f4661696c656420746f20696e6372656d656e74207469636b65742062616c616e5f8201527f63653a207469636b65745f62616c616e63655f6164642063616c6c207761732060208201520152565b610a1b604c606092610490565b610a248161099b565b0190565b610a3d9060208101905f818303910152610a0e565b90565b15610a4757565b610a4f610052565b62461bcd60e51b815280610a6560048201610a28565b0390fd5b90565b610a80610a7b610a8592610060565b610a69565b610060565b90565b90959492610ad394610ac2610acc92610ab8608096610aae60a088019c5f890190610778565b6020870190610778565b604085019061059f565b606083019061059f565b019061059f565b565b5f7f436f756c64206e6f742072656d6f7665206465706f7369740000000000000000910152565b610b096018602092610490565b610b1281610ad5565b0190565b610b2b9060208101905f818303910152610afc565b90565b15610b3557565b610b3d610052565b62461bcd60e51b815280610b5360048201610b16565b0390fd5b5f80610ddf610dee610e0f94610bd98480610b90610b9f85610b77610052565b928391600460208401630ad83b9d60e11b8152016105ac565b60208201810382520382610132565b610ba76105c1565b9082602082019151925af1610bc3610bbd6105e8565b9161066a565b6020610bce8261075a565b81830101910161073c565b610cb48580610bea6020850161075e565b610c38610bf883870161076b565b91610c29610c086060890161076b565b610c10610052565b948593600460208601630efe6a8b60e01b815201610785565b60208201810382520382610132565b610c7a610c476040870161075e565b610c6b610c52610052565b9384926004602085016337d6e7b960e11b8152016107fc565b60208201810382520382610132565b610c82610822565b9082602082019151925af1610c9e610c986105e8565b9161087f565b6020610ca98261075a565b818301019101610924565b508514610e1157610cc76040820161075e565b5b610d3d8680610cd96060860161076b565b610d1c8591610d0d610cec858a0161076b565b610cf4610052565b94859360046020860163f9d70f6960e01b815201610969565b60208201810382520382610132565b610d246105c1565b9082602082019151925af1610d376105e8565b50610a40565b610d496060830161076b565b90610d566020840161075e565b90610dbb610d6589860161076b565b94610d7e60a0610d776080840161076b565b920161076b565b90610da97f7ee7a1de9c18ce695c95b8b19fbdf26cce3544e3ca9e08c9f487776783d7599f96610a6c565b96610db2610052565b95869586610a88565b0390a2610dc6610052565b92839160046020840163029b6f6360e31b8152016105ac565b60208201810382520382610132565b610df66105c1565b9082602082019151925af1610e096105e8565b50610b2e565b565b610e1d6020820161075e565b610cc8565b610e2b90610565565b565b90610e5f94939291610e4f610e4a610e445f61047e565b1561048b565b6104f2565b610e5a60015f610545565b611389565b610e695f5f610545565b565b90565b610e82610e7d610e8792610e6b565b610a69565b610060565b90565b60207f6400000000000000000000000000000000000000000000000000000000000000917f456d707479207769746864726177616c7320617265206e6f7420616c6c6f77655f8201520152565b610ee46021604092610490565b610eed81610e8a565b0190565b610f069060208101905f818303910152610ed7565b90565b15610f1057565b610f18610052565b62461bcd60e51b815280610f2e60048201610ef1565b0390fd5b90565b610f41610f46916101f7565b610f32565b9052565b905090565b610f74610f6b92602092610f628161075a565b94858093610f4a565b938491016107c0565b0190565b80610f89601692610f909594610f35565b0190610f4f565b90565b60200190565b610fa5610faa9161045f565b610a6c565b90565b600560ff60981b0190565b610fcc610fc7610fd1926100d2565b610a69565b6100d2565b90565b610fdd90610fb8565b90565b610fe990610fd4565b90565b610ff590610fb8565b90565b61100190610fec565b90565b60e01b90565b9060208282031261102357611020915f01610697565b90565b610058565b611030610052565b3d5f823e3d90fd5b60407f617320756e7375636365737366756c0000000000000000000000000000000000917f4661696c656420746f2064656372656d656e74207469636b65742062616c616e5f8201527f63653a207469636b65745f62616c616e63655f72656d6f76652063616c6c207760208201520152565b6110b8604f606092610490565b6110c181611038565b0190565b6110da9060208101905f8183039101526110ab565b90565b156110e457565b6110ec610052565b62461bcd60e51b815280611102600482016110c5565b0390fd5b61110f906101f7565b9052565b9061115794929361114061113561114a9360808601908682035f8801526107cb565b95602085019061059f565b6040830190611106565b60608184039101526107cb565b90565b600360ff60981b0190565b60407f75636365737366756c0000000000000000000000000000000000000000000000917f4661696c656420746f2070726f64756365206d6573736167653a20707573685f5f8201527f66615f7769746864726177616c5f746f5f6f7574626f782063616c6c20756e7360208201520152565b6111e56049606092610490565b6111ee81611165565b0190565b6112079060208101905f8183039101526111d8565b90565b1561121157565b611219610052565b62461bcd60e51b81528061122f600482016111f2565b0390fd5b9050519061124082610207565b565b919060408382031261127c576112759061125c604061015b565b93611269825f8301611233565b5f860152602001611233565b6020830152565b610693565b9060408282031261129a57611297915f01611242565b90565b610058565b6112a990516101f7565b90565b91946112f46112fe929897956112ea60a0966112e06113059a6112d660c08a019e5f8b0190610778565b6020890190610778565b6040870190611106565b6060850190611106565b608083019061059f565b019061059f565b565b5f7f50726f7879207769746864726177206661696c65640000000000000000000000910152565b61133b6015602092610490565b61134481611307565b0190565b61135d9060208101905f81830391015261132e565b90565b1561136757565b61136f610052565b62461bcd60e51b81528061138560048201611348565b0390fd5b61142493919492946113ad866113a76113a15f610e6e565b91610060565b11610f09565b6113f4836113dc86916113cd6113c1610052565b93849260208401610f78565b60208201810382520382610132565b6113ee6113e88261075a565b91610f93565b20610f99565b602061140e611409611404610fad565b610fe0565b610ff8565b635445a2919061141c610052565b988992611004565b8252815f81611435600482016100a4565b03925af193841561167957878261153c5f806115d595611502829c6116499f6116439f9b6114cf869f8f6116099f946114ae8a939261149f85946114f399869161164b575b509f9193611486610052565b94859360046020860163d93ad06360e01b815201610969565b60208201810382520382610132565b6114b66105c1565b9082602082019151925af16114c96105e8565b506110dd565b9189946114da610052565b95869460046020870163e9f58a7760e01b815201611113565b60208201810382520382610132565b61150a61115a565b9082602082019151925af16115266115206105e8565b9161120a565b60206115318261075a565b818301019101611281565b9084903361159c899261155c60206115558e890161129f565b970161129f565b9087909161158a7fab68450c9e546f6062a861eebf8ec5bbd41b4425e26b20199c91227c7f9038ca97610a6c565b97611593610052565b968796876112ac565b0390a26115c63391936115ad610052565b948593600460208601635ae2fb3960e11b815201610785565b60208201810382520382610132565b916115fa6115e1610052565b9384926004602085016337d6e7b960e11b8152016107fc565b60208201810382520382610132565b611611610822565b9082602082019151925af161162d6116276105e8565b9161087f565b60206116388261075a565b818301019101610924565b50611360565b565b61166c915060203d8111611672575b6116648183610132565b81019061100a565b5f61147a565b503d61165a565b611028565b9061168b94939291610e2d565b565b906116c19695949392916116b16116ac6116a65f61047e565b1561048b565b6104f2565b6116bc60015f610545565b6118c4565b6116cb5f5f610545565b565b5190565b6116f06116f96020936116fe936116e7816116cd565b93848093610490565b958691016107c0565b610114565b0190565b979694611754611778979360c0966117476117709760408e6117406117356117629a60e08401908482035f8601526107cb565b96602083019061059f565b0190611106565b8b820360608d01526107cb565b9089820360808b01526116d1565b9087820360a08901526107cb565b94019061059f565b565b60407f6c20756e7375636365737366756c000000000000000000000000000000000000917f4661696c656420746f2070726f64756365206d6573736167653a20707573685f5f8201527f666173745f66615f7769746864726177616c5f746f5f6f7574626f782063616c60208201520152565b6117fa604e606092610490565b6118038161177a565b0190565b61181c9060208101905f8183039101526117ed565b90565b1561182657565b61182e610052565b62461bcd60e51b81528061184460048201611807565b0390fd5b95939196949290966101008701975f880161186291610778565b6020870161186f91610778565b6040860161187c91611106565b6060850161188991611106565b608084016118969161059f565b60a083016118a39161059f565b60c082016118b09161059f565b8082039060e001526118c1916107cb565b90565b959294939091946118e7866118e16118db5f610e6e565b91610060565b11610f09565b61192e8161191684916119076118fb610052565b93849260208401610f78565b60208201810382520382610132565b6119286119228261075a565b91610f93565b20610f99565b94611962602061194c611947611942610fad565b610fe0565b610ff8565b635445a2919061195a610052565b938492611004565b8252815f81611973600482016100a4565b03925af1908115611bd1575f91611ba3575b509386898991611993610052565b9283926020840163d93ad06360e01b8152600401926119b193610969565b6020820181038252036119c49082610132565b6119cc6105c1565b6020820191515a925f8094938194f16119e36105e8565b506119ed906110dd565b9087929390869086926119fe610052565b9687966020880163164faff760e31b815260040196611a1c97611702565b602082018103825203611a2f9082610132565b611a3761115a565b6020820191515a925f8094938194f1611a4e6105e8565b90611a589061181f565b611a618161075a565b60208201019060200190611a7491611281565b8391338791835f01611a859061129f565b93602001611a929061129f565b9588914291927f7e40c982e82bccb5e8bbd29f38bcfa3996f341ef9f51e2a9cffe086ec87a11c797611ac390610a6c565b98611acc610052565b978897611ad99789611848565b0390a233919091611ae8610052565b92839260208401635ae2fb3960e11b815260040192611b0693610785565b602082018103825203611b199082610132565b611b21610052565b918291602083016337d6e7b960e11b815260040191611b3f926107fc565b602082018103825203611b529082610132565b611b5a610822565b6020820191515a925f8094938194f1611b716105e8565b90611b7b9061087f565b611b848161075a565b60208201019060200190611b9791610924565b50611ba190611360565b565b611bc4915060203d8111611bca575b611bbc8183610132565b81019061100a565b5f611985565b503d611bb2565b611028565b90611be596959493929161168d565b56fea2646970667358221220639239758f1aa97212e0987b7ff7c67f6d9d41d772f18361405004914f3192a864736f6c634300081d0033";

pub(crate) const INTERNAL_FORWARDER_SOL_CONTRACT: &str = "0x60806040526004361015610010575b005b61001a5f35610029565b636fadcf720361000e57610197565b60e01c90565b60405190565b5f80fd5b5f80fd5b5f80fd5b60018060a01b031690565b61005590610041565b90565b6100618161004c565b0361006857565b5f80fd5b9050359061007982610058565b565b5f80fd5b5f80fd5b5f80fd5b909182601f830112156100c15781359167ffffffffffffffff83116100bc5760200192600183028401116100b757565b610083565b61007f565b61007b565b919091604081840312610107576100df835f830161006c565b92602082013567ffffffffffffffff8111610102576100fe9201610087565b9091565b61003d565b610039565b151590565b61011a9061010c565b9052565b5190565b60209181520190565b90825f9392825e0152565b601f801991011690565b61015f61016860209361016d936101568161011e565b93848093610122565b9586910161012b565b610136565b0190565b916101949261018760408201935f830190610111565b6020818403910152610140565b90565b346101c9576101b06101aa3660046100c6565b916103e5565b906101c56101bc61002f565b92839283610171565b0390f35b610035565b5f90565b606090565b600260ff60981b0190565b60209181520190565b60207f63616c6c65720000000000000000000000000000000000000000000000000000917f496e7465726e616c466f727761726465723a20756e617574686f72697a6564205f8201520152565b61024560266040926101e2565b61024e816101eb565b0190565b6102679060208101905f818303910152610238565b90565b1561027157565b61027961002f565b62461bcd60e51b81528061028f60048201610252565b0390fd5b906102c3949392916102be336102b86102b26102ad6101d7565b61004c565b9161004c565b1461026a565b6103b5565b9091565b905090565b90825f939282370152565b9091826102e7816102ee936102c7565b80936102cc565b0190565b90916102fd926102d7565b90565b634e487b7160e01b5f52604160045260245ffd5b9061031e90610136565b810190811067ffffffffffffffff82111761033857604052565b610300565b9061035061034961002f565b9283610314565b565b67ffffffffffffffff81116103705761036c602091610136565b0190565b610300565b9061038761038283610352565b61033d565b918252565b3d5f146103a75761039c3d610375565b903d5f602084013e5b565b6103af6101d2565b906103a5565b5f94919285949385925050926103d56103cc61002f565b938492836102f2565b03925af16103e161038c565b9091565b9061040192916103f36101ce565b6103fb6101d2565b90610293565b909156fea2646970667358221220da64ebb94fdb50a70d4dfe74a5b36e105052ee2de6a429d22b620a234a38cc0764736f6c634300081d0033";

pub(crate) const WITHDRAWAL_SOL_ADDR: Address = Address(FixedBytes::new([
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
]));

pub(crate) const FA_BRIDGE_SOL_ADDR: Address = Address(FixedBytes::new([
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
]));

pub(crate) const WITHDRAWAL_SOL_CODE_HASH: FixedBytes<32> = FixedBytes::new([
    0xd2, 0xbd, 0xc6, 0xd3, 0xa6, 0x3c, 0x08, 0x0f, 0xc2, 0x0c, 0xaf, 0x4c, 0x55, 0x94,
    0xd3, 0xc4, 0x60, 0xa5, 0x8e, 0x4d, 0xab, 0x60, 0xd6, 0x86, 0x8b, 0x39, 0xfd, 0x54,
    0x89, 0xcf, 0x69, 0x34,
]);

pub(crate) const FA_BRIDGE_SOL_CODE_HASH: FixedBytes<32> = FixedBytes::new([
    0x87, 0x8d, 0xfa, 0x45, 0x91, 0x2e, 0xdf, 0xbe, 0x9c, 0x41, 0xe2, 0x1d, 0xe1, 0x3d,
    0x0f, 0x39, 0x28, 0xaa, 0xf3, 0x1b, 0x13, 0x17, 0x3b, 0x26, 0xa3, 0xcf, 0xa5, 0x10,
    0x90, 0x6f, 0x39, 0xcd,
]);

pub(crate) const INTERNAL_FORWARDER_SOL_CODE_HASH: FixedBytes<32> = FixedBytes::new([
    0x6e, 0x92, 0x1a, 0xee, 0x7d, 0xfa, 0x53, 0x7e, 0x36, 0x9b, 0x96, 0xa9, 0xad, 0x51,
    0xe6, 0x20, 0xe4, 0x14, 0x48, 0x88, 0xf5, 0xfe, 0x7f, 0x4c, 0xf9, 0xd4, 0xcf, 0xeb,
    0x5d, 0x71, 0x2f, 0xa3,
]);

pub(crate) const SEND_OUTBOX_MESSAGE_PRECOMPILE_ADDRESS: Address =
    Address(FixedBytes::new([
        0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03,
    ]));

pub(crate) const TABLE_PRECOMPILE_ADDRESS: Address = Address(FixedBytes::new([
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x04,
]));

pub(crate) const GLOBAL_COUNTER_PRECOMPILE_ADDRESS: Address = Address(FixedBytes::new([
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x05,
]));

pub(crate) const CHANGE_SEQUENCER_KEY_PRECOMPILE_ADDRESS: Address =
    Address(FixedBytes::new([
        0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06,
    ]));

#[cfg(test)]
pub(crate) const PRECOMPILE_BURN_ADDRESS: Address = Address(FixedBytes::new([
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xde, 0xad,
]));

pub(crate) const CUSTOMS: [Address; 6] = [
    WITHDRAWAL_SOL_ADDR,
    FA_BRIDGE_SOL_ADDR,
    SEND_OUTBOX_MESSAGE_PRECOMPILE_ADDRESS,
    TABLE_PRECOMPILE_ADDRESS,
    GLOBAL_COUNTER_PRECOMPILE_ADDRESS,
    CHANGE_SEQUENCER_KEY_PRECOMPILE_ADDRESS,
];

// Rationale regarding the cost:
// A few decoding/encoding functions.
pub(crate) const SEND_OUTBOX_MESSAGE_BASE_COST: u64 = 500;

// Rationale regarding the cost:
// Covers the cost of 2 r/w access on cold keys.
// In particular, worst case for a cold read 2100 + the worst case for
// cold write 22100 (inserting a non zero value to a zero value).
pub(crate) const TICKET_TABLE_BASE_COST: u64 = 24_200;

// Rationale regarding the cost:
// Covers the cost of 2 r/w access on cold keys.
// In particular, worst case for a cold read 2100 + the worst case for
// cold write 22100 (inserting a non zero value to a zero value).
pub(crate) const GLOBAL_COUNTER_BASE_COST: u64 = 24_200;

// Rationale regarding the cost:
// Covers the cost of 2 r/w access on cold keys.
// In particular, worst case for a cold read 2100 + the worst case for
// cold write 22100 (inserting a non zero value to a zero value).
pub(crate) const UPGRADE_SEQUENCER_PRECOMPILE_BASE_COST: u64 = 24_200;

pub(crate) const SEQUENCER_UPGRADE_DELAY: u64 = 60 * 60 * 24; // 24 hours

#[cfg(test)]
mod test {
    use super::{
        FA_BRIDGE_SOL_CODE_HASH, FA_BRIDGE_SOL_CONTRACT,
        INTERNAL_FORWARDER_SOL_CODE_HASH, INTERNAL_FORWARDER_SOL_CONTRACT,
        WITHDRAWAL_SOL_CODE_HASH, WITHDRAWAL_SOL_CONTRACT,
    };

    use crate::helpers::storage::bytes_hash;
    use revm::{
        primitives::{hex::FromHex, Bytes, FixedBytes},
        state::Bytecode,
    };

    fn check_code_hash_validity(code: &str, code_hash_voucher: FixedBytes<32>) {
        let bytecode = Bytecode::new_legacy(Bytes::from_hex(code).unwrap());
        let code_hash = bytes_hash(bytecode.original_byte_slice());
        // Keep this until the script is updated
        println!(
            "{:?}",
            code_hash
                .iter()
                .map(|e| format!("0x{e:02x}"))
                .collect::<Vec<String>>()
                .join(", ")
        );
        assert_eq!(code_hash, code_hash_voucher)
    }

    #[test]
    fn check_withdrawal_sol_code_hash() {
        check_code_hash_validity(WITHDRAWAL_SOL_CONTRACT, WITHDRAWAL_SOL_CODE_HASH)
    }

    #[test]
    fn check_fa_bridge_sol_code_hash() {
        check_code_hash_validity(FA_BRIDGE_SOL_CONTRACT, FA_BRIDGE_SOL_CODE_HASH)
    }

    #[test]
    fn check_internal_forwarder_sol_code_hash() {
        check_code_hash_validity(
            INTERNAL_FORWARDER_SOL_CONTRACT,
            INTERNAL_FORWARDER_SOL_CODE_HASH,
        )
    }
}
