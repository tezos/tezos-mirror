.test_template:
  extends:
    - .default_settings_template
    - .image_template__runtime_build_test_dependencies_template
    - .rules_template__development
  stage: test
  before_script:
    - . ./scripts/version.sh
  retry: 2
  # avoid pushing cache for testing stage
  cache:
    key: "$CI_COMMIT_REF_SLUG"
    policy: pull

.unit_test_template:
  extends: .test_template
  artifacts:
    name: "$CI_JOB_NAME-$CI_COMMIT_SHA"
    paths:
      - test_results
    reports:
      junit: test_results/*.xml
    expire_in: 1 day
    when: always

unit:non-proto:
  extends: .unit_test_template
  script:
    - scripts/test_wrapper.sh src/lib_store/legacy_store store_legacy_store
    - scripts/test_wrapper.sh src/lib_store store
##END_UNITTEST##
