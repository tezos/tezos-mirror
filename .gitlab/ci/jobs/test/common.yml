.test_template:
  extends:
    - .default_settings_template
    - .image_template__runtime_build_dependencies
    - .template__coverage
  needs:
    - "build_x86_64-released"
    - "build_x86_64-exp-dev-extra"
  stage: test
  before_script:
    - . ./scripts/version.sh
    - eval $(opam env)
  retry: 2

# Merge coverage files after the execution
.template__coverage_files:
  extends: .template__coverage
  artifacts:
    name: "coverage-files-$CI_JOB_ID"
    paths:
      - $BISECT_FILE
    expire_in: 1 day
    when: on_success
